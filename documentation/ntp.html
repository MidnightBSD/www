<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MidnightBSD Documentation - NTP configuration</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="../css/essence.css">
    <link rel="canonical" href="https://www.midnightbsd.org/documentation/dns.html">
</head>
<body>
<div id="globe">
    <div id="header"><h1 title="MidnightBSD Home"><a href="../" title="MidnightBSD Home">MidnightBSD: The BSD For Everyone</a></h1></div>
    <!--#include virtual="/menu.html"-->
    <div class="clear"></div>
    <div id="text">
        <h2><img src="../images/oxygen/doc32.png" alt="" /> NTP Configuration</h2>
        <div id="toc">
            <h3>Contents</h3>
            <ul>
                <li><a href="#s1b">Introduction</a></li>
                <li><a href="#s1c">Switching to ntp</a></li>
                <li><a href="#s1d">Switching to ntpsec</a></li>
                <li><a href="#s1e">Syncing on startup with rdate</a></li>
                <li><a href="index.html"><strong>Documentation</strong></a></li>
            </ul>
        </div>

        <h3 id="s1b">Introduction</h3>

        <p>MidnightBSD uses OpenNTPD as the system ntpd by default. For many simple time synchronization needs, this is adequate.</p>

        <p>It is recommended to configure at least 4 NTP servers.</p>

        <p>Enable it as follows:</p>

        <code>doas sysrc ntpd_enable="YES"</code>

        <p>After enabling, start the daemon:</p>

        <code>doas service ntpd start</code>


        <h3 id="s1c">Switching to ntp</h3>

        <p>You can install ntpd from mports:</p>

        <code>doas mport install ntp</code>

        <p>Disable the system ntpd</p>
        <pre>
doas sysrc ntpd_enable="NO"
doas service ntpd stop
        </pre>

        <p>Then enable ntp</p>

        <pre>
doas sysrc ntp_enable="YES"
doas sysrc ntp_sync_on_start="YES"
        </pre>

        To set ntp flags: <code>doas sysrc ntp_flags="-g"</code>

        <p>Edit the configuration file in /usr/local/etc/ntp.conf</p>

        <p>After enabling, start the daemon:</p>

        <code>doas service ntp start</code>

        <h4>Example configuration file</h4>

        <pre>
server time.nist.gov iburst
server time.apple.com iburst
server 0.midnightbsd.pool.ntp.org iburst
server 1.midnightbsd.pool.ntp.org iburst
server 2.midnightbsd.pool.ntp.org iburst
server 3.midnightbsd.pool.ntp.org iburst
driftfile /var/db/ntp.drift
tinker panic 0
tinker step 0.128
        </pre>

        <h4>Using GPS as a source</h4>

        <p>Example configs in /usr/local/etc/ntp.conf:</p>

        <pre>
# gps source directly
#server 127.127.20.0 mode 0 minpoll 4 maxpoll 4
#fudge 127.127.20.0 refid GPS time1 0.000
# pps source directly
#server 127.127.22.0 minpoll 4 maxpoll 4 prefer
#fudge 127.127.22.0 refid PPS flag3 1
# uncomment for gpsd
#server 127.127.28.0 minpoll 4 maxpoll 4
#fudge 127.127.28.0 refid GPS strtaum 0 time1 0.060
        </pre>

        <p>Adjust time1 offsets to get your GPS source to be within +- 5 seconds of internet servers</p>

        <h5>Setup gpsd</h5>
        <pre>
doas sysrc gpsd_enable="YES"
doas sysrc gpsd_flags="-n"
doas sysrc gpsd_devices="/dev/cuaU0"
        </pre>

        <h3 id="s1d">Switching to ntpsec</h3>

        <p>You can install ntpsec from mports:</p>

        <code>doas mport install ntpsec</code>

        <p>Disable the system ntpd</p>
        <pre>
doas sysrc ntpd_enable="NO"
doas service ntpd stop
        </pre>

        <p>Then enable ntpsec:</p> <code>doas sysrc ntpsec_enable="YES"</code>

        <p>Edit the configuration file in /usr/local/etc/ntpsec.conf</p>

        <p>After enabling, start the daemon:</p>

        <code>doas service ntpsec start</code>

        <p>Warning: ntpsec port is not complete yet.  The daemon works, but there are issues with the python utilities.</p>

        <p>Enabling NTS</p>

        <pre>
nts enable
# Point to your existing key and certificate
nts key /etc/ssl/mydomain.key
nts cert /etc/ssl/mydomain.crt
        </pre>

        <h3 id="s1e">Syncing on startup with rdate</h3>

        <p>The base system includes the rdate utility to sync time.</p>
        <p>For example, to manually sync time on the CLI</p>
        <code>doas rdate -n stargazer.midnightbsd.org</code>

        <p>To automatically sync time at system startup</p>
        <pre>
doas sysrc rdate_enable="YES"
doas sysrc rdate_flags="-n stargazer.midnightbsd.org"
        </pre>

            <!--#include virtual="/disqus.html"-->
    </div>
    <!--#include virtual="/footer.html"-->
</body>
</html>
